## 請簡單解釋什麼是 Single Page Application

以往的網頁開發，一個網站下會有很多網頁，發別顯示與處理各種不同的資料與事件。例如 week9-11 的留言板，就是這樣的方式，首頁、登入頁面、編輯頁面還有管理頁面都分開，要到達不同的頁面就是輸入不同的網址。這種方式瀏覽器所需要做的工作就是發出 request，以及把 response 渲染出來。以這種方法開發的各個網頁幾乎都是靜態網頁，如果要改變某筆資料以及要去到其他頁面，就要重新發送 request 並且重新載入頁面。  
而 SPA 的留言板則是在同一個網頁上就可以完成所有功能、更新資料，並且不用重新載入。要登入，點擊「登入」後不會導入到另一個網址，而是維持在原來的網址。頁面會刷新，不過不會像重新載入會因為 response 還沒有回來而產生的空白頁面(如果沒有寫好還是有可能)。使用者在操作上會有與以往不同的體驗，感覺自己不是瀏覽網頁，而是在使用一個 app。  
能達成 SPA，是靠著非同步請求。本來是由瀏覽器發出 request 與接收 response，SPA 則是藉由非同步請求，由網頁背後的 JS 發出 request 與處理 response 傳回的資料，雖然都要經過瀏覽器，但是瀏覽器在這邊的角色比較像是資訊的通道，只管資訊通過而不做處理。所以其實 SPA 在更新資料、改變頁面的時候還是會有需要發 request 的時候，但是前端可以用很多方法讓這個過程不像多網頁式網站一樣會有空白期。
除了使用者體驗之外，兩者在開發上也有所不同。傳統多網頁式在開發上，前端還有後端緊密相連。雖然大致區分，前端是管使用者看得到的東西，會用到包括 HTML、CSS、JS，但是因為這些都是由瀏覽器收到 response 之後產生的，所以這三個語言的使用複雜度較低，比較多會著重在視覺效果上的呈現，幾乎不用做資料處理，在這種開發方式下，前端如果要處理資料也需要碰後端的東西；同樣的，後端工程師除了 server、database 之外，也要去注意這些東西輸出之後會長什麼樣子，並且提供前端工程師一些網頁元件模板，不會純粹只注重處理 reqeust 與 response 等。  
而 SPA 則可以達成前後端分離，後端只需要做出 API 文件，純粹提供資料即可，不需要考慮網頁呈現出來的結果；前端則可以專心在網頁要如何呈現資料，資料如何來，就是串 API 非同步獲得資料，並且用得到資料去處理頁面與事件。這邊要注意一點，就是這種前後端分離的開發做法在傳統的多網頁式也是可以達成的，不過如果要做 SPA 就必須要使用這種前後端分離的開發方式。

## SPA 的優缺點為何

SPA 在使用者這邊的優點是使用者體驗會得到提升，使用者不用忍受每做一個動作會有網頁的空白以及斷點，這在現在網路串流服務盛行尤其重要，串流會因為網頁重新載入而中斷，這對於串流體驗上是很不好的。SPA 可以做到在使用串流服務的同時，又可以瀏覽同個網站中的內容，而不會中斷串流，這在實況、音樂串流等都能大大增加使用者體驗。不過這樣也有缺點，使用者會發現一開始載入網頁就比較慢，這是因為達成 SPA 必須要在瀏覽器中預先載入很多程式碼與模板，所以如果使用者只是想要簡單看少數資料，但是網頁卻是 SPA，就要花比較多的時間去獲得。  
而在前端開發上，如前所述可以強制前後端分離，這在開發上的好處就是分工明確，前端可以專心在處理「看得到」的部分，任何需要的資料只需要透過串 API 即可，這樣可以不需要知道後端是用什麼語言與框架開發，只要先協調好 API 的格式即可。除了前後端的工作分明之外，程式碼的易讀性也會大幅提升。不會有同個網頁下有 HTML、CSS 也有 PHP，甚至還會再多 JS。不過同樣也有缺點，這就是前端撰寫的程式碼複雜度大幅上升，例如這樣就要處理很多同步、非同步、racing condition。剛剛所說使用者獲得更好的體驗，這點是要建立在前端開發者有寫出好的網頁，如果沒有處理好 racing condition 等問題，就會大大降低使用者體驗。例如，使用者在短時間內新增兩則留言，如果程式碼沒有處理好，就可能會發生第一則留言新增的時間比第二則留言慢，類似的狀況若一再出現，爛網站的名聲就不脛而走。還有一個缺點就是因為 SPA 的內容幾乎都是由 JS 動態產生，所以在使用爬蟲時，若爬蟲不支援執行 JS，那麼爬蟲爬到的網頁原始碼就只有很短的內容，無從判斷這個網頁到底有什麼內容，這點在需要大量流向與曝光的商業模式中是個硬傷。

## 這週這種後端負責提供只輸出資料的 API，前端一律都用 Ajax 串接的寫法，跟之前透過 PHP 直接輸出內容的留言板有什麼不同？

前端歸前端，後端歸後端，這在程式碼的易讀性上有很大的提升。week9-11 的留言板 php 原始檔案很難閱讀，先不說多種語言混在一起，光是縮排就會讓人不知道這段程式碼到底在哪層。  
前後端分離之後，後端只要負責輸出資料，所以只會用到 php，而且不會有其他語言影響閱讀，這在 debug、維護與擴充上都比較好做。以往要多一個功能就要多一整個頁面；分離後，多一個功能如果現有的資料已經足夠使用，可以不用再多寫一個 API，或者只要做少數的變動就可以。前端雖然也受惠於此不用忍受雜亂的程式碼，但是隨之而來的是程式碼複雜度大幅增加，以往不同功能只要引導到不同頁面即可，幾乎可以說一個 `<a></a>` 就可以；分離後，程式碼中就要多很多事件監聽器，並且要做許多非同步的 request，不僅僅拿資料，也要傳送資料，很像在與伺服器溝通。而且為了確保執行順序，還要對 callback 有更深的認識。在 php 留言板，基本上沒有用到多少 callback，因為多網頁留言板已經讓執行順序固定，不會有 racing condition。